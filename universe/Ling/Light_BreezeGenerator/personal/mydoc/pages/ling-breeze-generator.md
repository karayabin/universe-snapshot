Ling Breeze Generator 
=================
2019-09-13 -> 2020-02-13




Overview
------------
2020-02-04

The **LingBreezeGenerator** will generate classes for you, saving you a lot of typing.

Those classes are ORM classes (which I designed), and so they are derived from the tables of a database.

The **LingBreezeGenerator** can either analyze the tables directly from an actual database connection,
or it can create tables from a mysql dump, such as one generated by MySqlWorkBench and/or phpMyAdmin.   

There are 5 types of generated classes:

- **children classes**: (aka classes), those are the main classes, they contain the ORM methods.
 
    Each class implements the **interface** designed for it, and all classes extend the same **base api** class.  
- **interfaces**: defines the methods implemented by the **children classes**. There is one interface per **child class**.
- **factory**: the factory gives access to all **children classes**. A developer will typically use the **factory** to access any **child class**, rather than trying to instantiate the **child class** manually. 
- **base api**: the parent class for all **children classes**. It contains common methods shared by all **children classes**.
- **custom**: those are classes created by the developer manually (i.e. not generated) to extend the functionality of the generated **children classes**.
    
    Those classes are NEVER overwritten by the generator. Note that when the developer creates such classes, he also generally wants to extend
    the corresponding interface's methods.
    

To configure the generator, we use a configuration array (see the configuration section for more details).    



Example of a generated structure in the file system:


- /path/to/api/:
    - Classes/:
        - FruitApi.php (the **base api** class)
        - AppleApi.php (an example **child** class)
        - BananaApi.php (an example **child** class)
        - CherryApi.php (an example **child** class)
    - Interfaces/:
        - AppleApiInterface.php 
        - BananaApiInterface.php
        - CherryApiInterface.php
    - FruitFactory.php (the **factory** class)
    - Custom/: (this is created by the user manually, to extend the generated classes' functionality)
        - CustomBananaApi.php (an example of **custom** class, which contain specific methods created by the developer)




Design
----------
2020-02-04 -> 2020-02-13

In this section I want to give you an overview the content of what's generated.


The generated classes are based on the (database) tables, and some special columns such as the [ric](https://github.com/lingtalfi/NotationFan/blob/master/ric.md) columns
will be translated to methods.

To ease understanding, we will use the example of a table named "apple", from the following schema:

- **apple**:
    - id: auto-incremented key
    - name: varchar(64), unique index
    - weight: decimal(10,2)
    - type_id: foreign key referenced by the **apple_type.id** column
- **apple_type**:
    - id: auto-incremented key    
    - name: varchar(64)
    
- **human**:
    - id: auto-incremented key    
    - name: varchar(64), unique index
    
- **human_has_apple**:
    - human_id: fk referencing human.id    
    - apple_id: fk referencing apple.id
    
    
    
The generated classes for the **apple** table look like this:


- Child class methods:
    - insertApple ( array $apple, bool $ignoreDuplicate = true, bool $returnRic = false )
    - getAppleById ( int $id, $default = null, bool $throwNotFoundEx = false )
    - getAppleByName ( string $name, $default = null, bool $throwNotFoundEx = false )
    - getApple ( $where, array $markers = [], $default = null, bool $throwNotFoundEx = false )
    - getApples ( $where, array $markers = [] )
    - getAppleIdByName ( string $name, $default = null, bool $throwNotFoundEx = false )
    - getApplesByHumanId ( string $humanId )
    - getApplesByHumanName ( string $humanName )
    - getAppleIdsByHumanId ( string $humanId )
    - getAppleNamesByHumanId ( string $humanId )
    - getAppleIdsByHumanName ( string $humanName )
    - getAppleNamesByHumanName ( string $humanName )
    
    - getAllIds ( ): array
    - updateAppleById ( int $id, array $apple )
    - updateAppleByName ( string $name, array $apple )
    - deleteAppleById ( int $id )
    - deleteAppleByName ( string $name )
    

- BaseApi class (public) methods:
    - setPdoWrapper (SimplePdoWrapperInterface $pdoWrapper)
    - setContainer(LightServiceContainerInterface $container)


- Interface class methods (same as the child class methods)

- Factory methods:
    - setPdoWrapper(SimplePdoWrapperInterface $pdoWrapper)
    - setContainer(LightServiceContainerInterface $container)
    - getAppleApi(): AppleInterface         
    - ...getXXXApi(): XXXInterface        





### Extra classes
2020-03-05

If the table's [ric](https://github.com/lingtalfi/NotationFan/blob/master/ric.md) are all foreign keys (i.e. if the table is a **has table**),
then extra methods are being generated for the child class and the interface:

- Child class methods (for **has tables** only):
    - deleteUserHasAppleByUserId( int $user_id )
    - deleteUserHasAppleByAppleId( int $apple_id )




How to use it?
-----------
2020-02-03

First create a configuration file (see the config section below for more details), and register it via our service.
In the following example, we registered it with the identifier **luda**.


```php
az($container->get("breeze_generator")->generate("luda"));
```






Config example
-------------
2020-02-04

Here is an example of how a configuration file might like (using [babyYaml](https://github.com/lingtalfi/BabyYaml) format here):

```yaml

class: Ling\Light_BreezeGenerator\Generator\LingBreezeGenerator
conf:
    dir: ${app_dir}/universe/Ling/Light_UserData/Api
    prefix: luda
    usePrefixInClassName: false
    relativeDirs:
        classes: Classes
        interfaces: Interfaces
        baseApi: Classes
        factory: null
        custom: Custom

    factoryClassName: LightUserDataApiFactory
    baseClassName: LightUserDataBaseApi

    namespace: Ling\Light_UserData\Api

    classSuffix: Api
    interfaceSuffix: Interface
    customPrefix: Custom

    overwrite:
        classes: true
        interfaces: false
        baseApi: false
        factory: true

    generate:
        file: /path/to/Ling/Light_UserData/assets/fixtures/recreate-structure.sql



```



The configuration
------------
2019-12-19 -> 2020-02-04


### Dir

Mandatory.

The directory which will contain all the generated classes.

The **${app_dir}** tag will be replaced with the actual application directory.



### factoryClassName

Mandatory, string.

The short class name for the generated **factory** class.



### baseClassName

Mandatory, string.

The short class name of the generated **base api** class.




### overwrite

Optional, array = [].

Defines the overwriting behaviour of the generator.

By default (or if empty), the following array is implied:

- overwrite:
    - classes: true (whether to overwrite generated classes)
    - interfaces: false (whether to overwrite generated interfaces)
    - baseApi: false (whether to overwrite the generated **base api** class)
    - factory: true (whether to overwrite the generated **factory** class)


### useMicroPermission

Optional, bool = false. Deprecated.

Whether classes generated methods should use the micro-permission checking system.
We use the [micro-permission recommended notation for database](https://github.com/lingtalfi/Light_MicroPermission/blob/master/doc/pages/recommended-micropermission-notation.md#database-interaction).




### customPrefix

Optional, string = "Custom".

The string to prepend to the **child**'s short class name to obtain the **custom**'s short class name.


### classSuffix

Optional, string = "Object".

The string to append to the camel cased table name to obtain the **child**'s short class name.


### interfaceSuffix

Optional, string = "Interface".

The string to append to the **child**'s short class name to obtain the **interface**'s short class name.

 


### generate

Mandatory, array.


Tells the generator how to generate the classes.

The possible options are the following (you can only use one of them at the time):

- prefix: string. The generator will read the tables via your actual database connection, and will generate the classes
    for the tables which start with the specified prefix followed by an underscore. 
    
- tables: array. The generator will read the tables via your actual database connection, and generate the classes for the tables
    that are specified in the given array and exist in the database. 
    
- file: string. The generator will parse the given file, and generate classes from the tables descriptions in it.

    The notation used in the file must be similar to a sql dump generated via a tool like MysqlWorkBench (or phpMyAdmin).



### relativeDirs

Optional, array = [].

Defines the paths of the generated classes, relative to the dir directory (see the dir configuration key for more details).

By default (or if empty), the following array is implied:

- relativeDirs:
    - classes: Classes 
    - interfaces: Interfaces 
    - baseApi: Classes
    - factory: null (means the class will be generated at the api root dir level)
    - custom: Custom




### usePrefixInClassName

Optional, bool = false.

If your table has a prefix (for instance the **lud** prefix in the **lud_user** table), you can decide to include or remove it from the generated class name.
The prefix is defined using the **prefix** (configuration) option.


### prefix

Optional, string = null.

If your table has a prefix (for instance the **lud** prefix in the **lud_user** table) and you used the **usePrefixInClassName**=false, then you need to specify the prefix to remove (using this option).


### allPrefixes

Optional, array = [].

If your table is related to other tables with other prefixes (usually tables created by other plugins),
then this array should contain those "foreign" prefixes. Those prefixes are used to generate the 
stripped version of foreign table names which might be used in some generated methods using the
**has** relationship.

Note: the prefix defined using the **prefix** option is always automatically added to the
allPrefixes array (i.e. you don't need to add it to the allPrefixes array). 


### namespace

Mandatory, string.

The base namespace for all generated classes.

Note: the relative dir (see the **relativeDirs** option) might be appended to that namespace to obtain the generated class's namespace (depending on the generated class).












  