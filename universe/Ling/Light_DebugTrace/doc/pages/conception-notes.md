Light DebugTrace
==================
2020-06-25



This is a debug tool for the [light framework](https://github.com/lingtalfi/Light).


It's inspired from the great [Light_Kit_Admin_DebugTrace](https://github.com/lingtalfi/Light_Kit_Admin_DebugTrace) plugin.



This debug tool gives access to basic information:


- the http request: url, $_GET, $_POST, $_FILE, $_COOKIE
- the matched route (if any)
- the controller being used
- the csrf token values (if you use the [csrf_simple](/komin/jin_site_demo/universe/Ling/Light_CsrfSimple) or [csrf_session](https://github.com/lingtalfi/Light_CsrfSession) service)
- events being used (i.e. events with some listeners attached to it)
- session variables




Prints to a file
-----------
2020-06-25


It outputs everything to external file(s).

The idea here is to open that file in a text editor with live update capabilities (such as sublime text for instance),
and put your browser window and text editor side to side, so that you can work in a browser window,
and have your info updated next to it, in your text editor window (that's my preferred debug workflow).

There are actually two modes: 

- either put the last http request info on one file (use the **setTargetFile** method)
- or put each http request info on a separate file (use the **setTargetDir** method)


Or you could use both at the same time.



A live debugger
-----------
2020-06-25


One nice thing about this debugger is that it's a live debugger: it writes to the file bit of information after bit.
That's because sometimes, you encounter an error (like a fatal error) that interrupts the application.
When that happens, you still have all the information that the debugTrace service could collect before the script was interrupted,
which is a valuable information for debugging. 



httpRequest filters
--------------
2020-06-25


Not all requests are relevant to your debugging session.

For instance in my case I had this **/user-data?file=images/avatar.png** request, which renders an image,
and I wasn't interested in that.

Your mileage might vary, but the point is that we need to be able to filter out some requests.


The http request filters let you do that in the form of an array with the following properties:


- ?urlIgnoreIfStartWith: array|string. If the uri starts with one of the items defined by this property, it will be filtered out.  


Security warning
-------------
2020-06-25



We recommend that you never use this plugin in production, only in a development environment.
Why, because this will log information to a file, and that information is potentially critical.

In particular, the following bits:

- http_request.$_POST: may contain the password in clear of an user which logs in
- csrf_token: may contain the session token, which if discovered by a malicious attacker makes all kind of csrf attacks very likely



Recommended alias
-----------
2020-06-25


For efficiency purposes, we recommend using these aliases (replacing the paths with your own):


```bash
alias ldd='open "/komin/jin_site_demo/log/Light_DebugTrace/light_debugtrace.txt"'
alias lddd='open "/komin/jin_site_demo/log/Light_DebugTrace/all"'
```








Example of output
-----------
2020-06-25

Here is an example of output generated by this service.

Note: it's a bad idea to have PHPSESSID as a cookie, but that's just an example.


```yaml
datetime: 2020-06-25 10:49:44
http_request: 
    url: /login
    $_GET: []
    $_POST: []
    $_FILES: []
    $_COOKIE: 
        _ga: GA1.1.1122014952.1558336159
        PHPSESSID: r8dpefabbfj6458c40k11lpn3a
    

csrf_token: 7b852cb458906dcbcc2efa51e71c5fca

route: 
    name: lka_route-login
    pattern: /login
    controller: Ling\Light_Kit_Admin\Controller\LoginFormController->render
    requirements: []
    url_params: []
    host: null
    is_secure_protocol: null
    is_ajax: false

events: 
    - Light.initialize_1
    - Light.on_route_found
    - Light_Kit_Admin.on_page_rendered_before
    - Light_Kit.on_page_conf_ready
    - Light.end_routine

session: 
    light_csrf_session: 7b852cb458906dcbcc2efa51e71c5fca
    WebsiteUserManager: 
        id: 1
        identifier: null
        email: null
        avatar_url: null
        pseudo: null
        connect_time: false
        last_refresh_time: false
        session_duration: 500
        rights: []
        extra: []
    


```

